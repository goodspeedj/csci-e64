<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css">
    
  </head>

  <body onload="drawBackground();">

    <header>
      <div id="header">
        CS 171/CSCI E-64: Visualization<br />
        Homework 5, Problem 2: Web Visualization
      </div>
      <div id="name">
        James Goodspeed - jgoodsp@fas.harvard.edu
      </div>
    </header>

    <div id="description">
      <p>
        The following stock ticker graph shows the opening price of Bottomline 
        Technologies and Facebook over the past ten days.  The 'comment' field 
        consists of the volume on a given day.
      </p>
    </div>
    
    <div id="container">
      <canvas id="background" width="800" height="600"></canvas>
    </div>

    <div id="control">

    </div>

    <!-- Facebook stock price data -->
    <textarea id="csv">
      SYMBOL,OPEN,DATE,NORMDATE,VOLUME
      FB,28.01,02/26,1,31579420
      FB,27.34,02/27,2,44203880
      FB,26.84,02/28,3,82952930
      FB,27.05,03/01,4,54032140
      FB,27.76,03/04,5,32363520
      FB,27.88,03/05,6,40184170
      FB,28.10,03/06,7,33464760
      FB,27.57,03/07,8,74408360
      FB,28.43,03/08,9,44161320
      FB,28.01,03/11,10,35585960
    </textarea>

    <textarea id="json">
      [
          { 
            "OPEN": "26.28",
            "DATE": "02/26",
            "NORMDATE": "1",
            "VOLUME": "443842" 
          },

          { 
            "OPEN": "26.70",
            "DATE": "02/27",
            "NORMDATE": "2",
            "VOLUME": "343179"
          },
          {
            "OPEN": "27.20",
            "DATE": "02/28",
            "NORMDATE": "3",
            "VOLUME": "262821"
          },
          {
            "OPEN": "26.90",
            "DATE": "03/01",
            "NORMDATE": "4",
            "VOLUME": "297274"
          },
          {
            "OPEN": "27.47",
            "DATE": "03/04",
            "NORMDATE": "5",
            "VOLUME": "321933"
          },
          {
            "OPEN": "27.38",
            "DATE": "03/05",
            "NORMDATE": "6",
            "VOLUME": "278871"
          },
          {
            "OPEN": "27.60",
            "DATE": "03/06",
            "NORMDATE": "7",
            "VOLUME": "309123"
          },
          {
            "OPEN": "28.53",
            "DATE": "03/07",
            "NORMDATE": "8",
            "VOLUME": "425037"
            },
            {
            "OPEN": "28.33",
            "DATE": "03/08",
            "NORMDATE": "9",
            "VOLUME": "359761"
            },
            {
            "OPEN": "28.16",
            "DATE": "03/11",
            "NORMDATE": "10",
            "VOLUME": "155354"
            }
          ]
    </textarea>
    <script type="application/javascript">

      var data_csv  = document.getElementById("csv").value;
      var data_json = document.getElementById("json").value;
      var json      = JSON.parse(data_json);

      /*
       *  Gets the max value of the Y axis
       */
      function getYMax() {
          var max = 0;

          // Get the max from the json data
          for (i in json) {
              if (max < json[i].OPEN) {
                  max = json[i].OPEN;
              }
          }

          var csvRows = data_csv.split(/\n/);

          // get the max from the csv data
          for (var j = 1; j < csvRows.length; j++) {
              var row = csvRows[j].split(",");
              var price = row[1];

              if (max < price) {
                  max = price;
              }
          }

          // make sure max is a number
          max = parseFloat(max);

          // pad the max a bit
          max = max + 5;

          return max;
      }


      /*
       * Get the Y axis minimum
       */
      function getYMin() {
          var min = 99999;

          // Get the min from the json data
          for (i in json) {
              if (min > json[i].OPEN) {
                  min = json[i].OPEN;
              }
          }

          var csvRows = data_csv.split(/\n/);

          // get the min from the csv data
          for (var j = 1; j < csvRows.length; j++) {
              var row = csvRows[j].split(",");
              var price = row[1];

              if (min > price) {
                  min = price;
              }
          }

          // make sure max is a number
          min = parseFloat(min);

          // pad the max a bit
          min = min - 5;

          return min;


      }


      /*
       * Draw the line coresponding to the JSON data
       */
      function drawJSONLine(context) {
          var startX = 30;
          var visibleJSON = true;

          context.beginPath();

          context.moveTo(startX, 400 - ((parseFloat(json[0].OPEN) - getYMin()) * 40));


          for (var i = 1; i < json.length; i++) {
              startX += 60;
              var y = 400 - ((parseFloat(json[i].OPEN) - getYMin()) * 40);

              context.lineTo(startX, y);
          }

          if (visibleJSON == true) {
              context.strokeStyle = '#377EB8';
          }
          else {
              context.strokeStyle = '#E41A1C';
          }
          
          context.lineWidth = 3;
          context.stroke();
          
      }


      /*
       * Draw the line coresponding to the CSV data
       */
      function drawCSVLine(context) {
          var visibleCSV = true;
          var startX = 30;
          var csvRows = data_csv.split(/\n/);
          var rowOne = csvRows[1].split(",");
          var firstPrice = rowOne[1];

          context.beginPath();

          context.moveTo(startX, 400 - ((parseFloat(firstPrice) - getYMin()) * 40));

          for (var i = 2; i < csvRows.length; i++) {
              startX += 60;
              var row = csvRows[i].split(",");
              var price = row[1];
              var y = 400 - ((parseFloat(price) - getYMin()) * 40);

              context.lineTo(startX, y);
          }
          
          if (visibleCSV == true) {
              context.strokeStyle = '#4DAF4A';
          }
          else {
              context.strokeStyle = '#FFFFFF';
          }
          
          context.lineWidth = 3;
          context.stroke();

      }


      /*
       * Draw the graph key
       */
      function drawKey(context) {

          // facebook
          context.beginPath();
          context.moveTo(0, 450);
          context.lineTo(40, 450);
          context.strokeStyle = '#4DAF4A';
          context.lineWidth = 7;
          context.stroke();

          context.fillText("Facebook", 55, 452);

          // bottomline
          context.beginPath();
          context.moveTo(0, 470);
          context.lineTo(40, 470);
          context.strokeStyle = '#377EB8';
          context.lineWidth = 7;
          context.stroke();

          context.fillText("Bottomline Technologies", 55, 472);

      }
    

      /*
       * Draw the background canvas
       */
      function drawBackground() {
          getYMax();

          var canvas    = document.getElementById("background");
          

          if (canvas.getContext) {
              var context = canvas.getContext("2d");

              // x and y axis
              context.beginPath();
              context.moveTo(30, 10);
              context.lineTo(30, 400);
              context.lineTo(600,400);
              context.stroke();

              // Add text to X axis
              var xLabel = 30;
              for (i in json) {
                  context.fillText(json[i].DATE, xLabel, 420);
                  xLabel += 60;
              }

              // Add text to Y axis
              var yLabel = 400;
              for (var j = getYMin(); j < getYMax(); j++) {
                  context.fillText(j, 0, yLabel);
                  yLabel -= 40;
              }

              /*
              if (visibleCSV == true && visibleJSON == false) {
                  drawCSVLine(context);
              }
              else if (visibleJSON == true && visibleCSV == false) {
                  drawJSONLine(context);
              }
              */
              
              drawCSVLine(context);
              drawJSONLine(context);
              drawKey(context);


          }
          else {
              alert("Browser does not support canvas.");
          }
      }
      
    </script>
  </body>
</html>